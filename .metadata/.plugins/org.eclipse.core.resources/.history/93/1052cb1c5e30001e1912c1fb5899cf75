/* generated by Xtext 2.25.0
 */
package uk.ac.kcl.inf.languages.mockup.validation;

import org.eclipse.xtext.scoping.IScope
import org.eclipse.xtext.scoping.Scopes
import uk.ac.kcl.inf.languages.mockup.uiMockupLanguage.Screen
import org.eclipse.emf.ecore.EReference
import uk.ac.kcl.inf.languages.mockup.uiMockupLanguage.Entity
import uk.ac.kcl.inf.languages.mockup.uiMockupLanguage.CustomWidget
import uk.ac.kcl.inf.languages.mockup.uiMockupLanguage.Widget

/**
 * This class contains custom validation rules. 
 *
 * See https://www.eclipse.org/Xtext/documentation/303_runtime_concepts.html#validation
 */
class UiMockupLanguageValidator extends AbstractUiMockupLanguageValidator {
	
	@Check
	def void checkEntityNameStartsWithCapital(Entity entity) {
		if (!Character.isUpperCase(entity.name.charAt(0))) {
			error("Entity name must start with a capital letter.", entity, UiMockupPackage.Literals.ENTITY__NAME)
		}
	}

	@Check
	def void checkWidgetNamesUnique(Screen screen) {
		val widgetNames = screen.widgets.map[widget | widget.name]
		val duplicateWidgetNames = widgetNames.toSet.filter[name | widgetNames.filter[it == name].size > 1]
		for (duplicateWidgetName : duplicateWidgetNames) {
			error("Widget name '" + duplicateWidgetName + "' is not unique.", screen, UiMockupPackage.Literals.SCREEN__WIDGETS)
		}
	}

	@Check
	def void checkNavigationTargetExists(Navigation navigation) {
		val targetScreen = navigation.target
		if (targetScreen === null) {
			error("Navigation target screen is not specified.", navigation, UiMockupPackage.Literals.NAVIGATION__TARGET)
		}
	}

	@Check
	def void checkWidgetTypeIsValid(Widget widget) {
		if (widget instanceof CustomWidget) {
			val customWidget = widget as CustomWidget
			if (!isDataTypeValid(customWidget.type)) {
				error("Invalid data type '" + customWidget.type + "' for custom widget '" + widget.name + "'.", widget, UiMockupPackage.Literals.WIDGET__LABEL)
			}
		} 
	}

	// Helper method to check if a DataType is valid
	def boolean isDataTypeValid(String dataType) {
		return dataType == DataType::STRING || dataType == DataType::BOOLEAN || dataType == DataType::INTEGER
	}
	
}